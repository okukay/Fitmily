<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.d208.fitmily.walk.mapper.WalkMapper">

<!--parameterType 는 {} 으로 넘길데이터의 type임 -->


    <insert id="insertStopWalk"
            parameterType="Walk"
            useGeneratedKeys="true"
            keyProperty="walkId">
        INSERT INTO walk (
        user_id, walk_route_img, walk_start_time, walk_end_time, walk_distance, walk_heart_rate)
        VALUES(
        #{userId}, #{walkRouteImg}, #{walkStartTime}, #{walkEndTime}, #{walkDistance}, #{walkHeartRate})
    </insert>


    <select id="selectWalks"
            parameterType="map"
            resultType="com.d208.fitmily.walk.dto.WalkResponseDto">
        SELECT
        w.walk_id,
        w.user_id,
        u.user_nickname,
        u.user_profile_img,
        w.walk_route_img,
        w.walk_start_time,
        w.walk_end_time,
        w.walk_distance,
        w.walk_heart_rate,
        w.walk_calories,
        w.walk_step_count
        FROM walk w
        LEFT JOIN users u
        ON u.user_id = w.user_id
        <where>
            <if test="userId != null">
                AND w.user_id = #{userId}
            </if>
            <if test="start != null"><![CDATA[
        AND w.walk_start_time >= #{start}
      ]]></if>
            <if test="end != null"><![CDATA[
        AND w.walk_end_time   <= #{end}
      ]]></if>
        </where>
        ORDER BY w.walk_start_time DESC
    </select>





</mapper>